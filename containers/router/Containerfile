FROM ghcr.io/ublue-os/ucore-minimal:stable

ARG FILES_ROOT=./containers/router/files

RUN dnf install -y \
  node-exporter \
  dnsmasq \
  && dnf clean all

COPY ${FILES_ROOT}/dnsmasq.conf /etc/dnsmasq.d/99-router.conf
COPY ${FILES_ROOT}/sysctl.conf /etc/sysctl.d/99-router.conf
COPY ${FILES_ROOT}/nftables.conf /etc/nftables.conf

RUN systemctl enable nftables \
  && systemctl unmask dnsmasq.service \
  && systemctl unmask dnsmasq.socket \
  && systemctl enable dnsmasq \
  && systemctl enable node-exporter \
  && systemctl disable systemd-resolved

RUN bootc container lint
