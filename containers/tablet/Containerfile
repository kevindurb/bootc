FROM quay.io/fedora/fedora-silverblue:41

ADD https://pkg.surfacelinux.com/fedora/linux-surface.repo /etc/yum.repos.d/

RUN dnf install -y --allowerasing \
  iptsd \
  libwacom-surface && \
  dnf clean all && \
  ostree container commit

RUN dnf install -y snapd && \
  dnf clean all && \
  systemctl enable snapd.service && \
  /usr/bin/ln -sf /var/lib/snapd/snap / && \
  ostree container commit

RUN dnf install -y tailscale && \
  dnf clean all && \
  systemctl enable tailscaled.service && \
  ostree container commit

RUN dnf install -y \
  gstreamer1-plugin-libav \
  gstreamer1-plugin-openh264 \
  gstreamer1-plugins-base \
  gstreamer1-plugins-good \
  heif-pixbuf-loader && \
  dnf clean all && \
  ostree container commit

RUN dnf remove -y \
  firefox \
  firefox-langpacks && \
  dnf clean all && \
  ostree container commit

RUN dnf install -y \
  gnome-shell-extension-gsconnect \
  gnome-shell-extension-caffeine \
  gnome-shell-extension-appindicator && \
  dnf clean all && \
  ostree container commit

RUN dnf install -y syncthing && \
  dnf clean all && \
  systemctl --global enable syncthing.service && \
  ostree container commit

COPY ./scripts/dev-packages-install.sh /tmp
RUN /tmp/dev-packages-install.sh && \
  ostree container commit
