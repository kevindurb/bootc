# Base image with systemd support (if needed)
FROM ghcr.io/kevindurb/builder-bootc:latest AS builder

# Add your Bazzite OSTree remote
RUN ostree remote add --if-not-exists bazzite https://repo.bazzite.org

# Pull the desired Bazzite commit or branch
RUN ostree pull --repo=/var/tmp/repo bazzite:bazzite/x86_64/stable

# Export the OSTree commit to create a container filesystem
RUN ostree container export --repo=/var/tmp/repo bazzite:x86_64/stable /var/tmp/rootfs

# Build the final container
FROM scratch

# Copy the exported root filesystem
COPY --from=builder /var/tmp/rootfs/ /

# Bootable systemd setup for `bootc`
CMD ["/usr/lib/systemd/systemd"]
