---
version: 3

tasks:
  build:
    cmds:
      - cmd: mkdir -p ./lima-dist
      - cmd: podman pull ghcr.io/kevindurb/lima-bootc
      - cmd: >
          podman run --rm -it --privileged
          --security-opt label=type:unconfined_t
          -v $(pwd)/bootc-config.toml:/config.toml:ro
          -v $(pwd)/lima-dist:/output
          -v /var/lib/containers/storage:/var/lib/containers/storage
          --platform linux/arm64
          quay.io/centos-bootc/bootc-image-builder:latest
          --target-arch arm64
          --rootfs xfs
          --type qcow2
          --local ghcr.io/kevindurb/lima-bootc
